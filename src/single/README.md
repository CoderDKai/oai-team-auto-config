# S2A 账号批量添加工具

独立的S2A账号添加脚本，支持批量将OpenAI账号添加到S2A服务中。

## 功能特性

- ✅ 批量添加账号到S2A
- ✅ 自动注册未注册的账号
- ✅ 自动处理验证码（支持手动输入）
- ✅ 自动填写用户信息
- ✅ 完整的授权流程
- ✅ 跳过已存在的账号

## 使用方法

### 方式1: 从命令行传入账号

```bash
python src/single/add_accounts_to_s2a.py --accounts '[{"account":"test@example.com","password":"test@123"}]'
```

### 方式2: 从文件读取账号

1. 创建账号文件 `accounts.json`:

```json
[
  {
    "account": "user1@example.com",
    "password": "YourPassword123!"
  },
  {
    "account": "user2@example.com",
    "password": "YourPassword456!"
  }
]
```

2. 运行脚本:

```bash
python src/single/add_accounts_to_s2a.py --file accounts.json
```

或使用示例文件:

```bash
cp src/single/accounts.json.example accounts.json
# 编辑 accounts.json 填入真实账号
python src/single/add_accounts_to_s2a.py --file accounts.json
```

## 前置要求

1. **配置S2A服务**

在 `config.toml` 中配置S2A服务信息:

```toml
[s2a]
api_base = "https://your-sub2api-service.com/api/v1"
admin_key = "your-admin-api-key"
concurrency = 10
priority = 50
group_ids = []
group_names = ["codex"]
```

2. **准备接收验证码的邮箱**

确保您能够接收到注册邮箱的验证码邮件。脚本会在终端等待您手动输入验证码。

## 工作流程

```
┌─────────────────────────────────────────────────────────┐
│  1. 验证S2A服务连接                                      │
└─────────────────┬───────────────────────────────────────┘
                  │
┌─────────────────▼───────────────────────────────────────┐
│  2. 加载账号列表                                         │
│     - 从命令行参数或文件读取                             │
│     - 验证JSON格式                                       │
└─────────────────┬───────────────────────────────────────┘
                  │
┌─────────────────▼───────────────────────────────────────┐
│  3. 逐个处理账号                                         │
│                                                          │
│  ┌────────────────────────────────────────────────┐    │
│  │  3.1 检查账号是否已存在于S2A                   │    │
│  │      └─ 已存在 → 跳过                          │    │
│  └────────────────────────────────────────────────┘    │
│                                                          │
│  ┌────────────────────────────────────────────────┐    │
│  │  3.2 注册或登录账号                            │    │
│  │      ├─ 打开ChatGPT首页                        │    │
│  │      ├─ 输入邮箱和密码                         │    │
│  │      ├─ 处理验证码（自动获取或手动输入）       │    │
│  │      └─ 填写个人信息（姓名、生日）             │    │
│  └────────────────────────────────────────────────┘    │
│                                                          │
│  ┌────────────────────────────────────────────────┐    │
│  │  3.3 执行S2A授权                               │    │
│  │      ├─ 生成S2A授权URL                         │    │
│  │      ├─ 打开授权页面                           │    │
│  │      ├─ 登录账号                               │    │
│  │      ├─ 点击授权按钮                           │    │
│  │      ├─ 获取授权码                             │    │
│  │      └─ 创建S2A账号                            │    │
│  └────────────────────────────────────────────────┘    │
│                                                          │
└─────────────────┬───────────────────────────────────────┘
                  │
┌─────────────────▼───────────────────────────────────────┐
│  4. 打印处理结果                                         │
│     - 成功数量                                           │
│     - 失败账号列表                                       │
└──────────────────────────────────────────────────────────┘
```

## 验证码处理

当脚本检测到验证码页面时，会在终端提示您手动输入验证码：

```
⚠️ 检测到验证码页面，请查收邮箱: user@example.com
⚠️ 请在终端输入验证码: 
```

此时请：
1. 查收邮箱中的验证码
2. 在终端输入验证码
3. 按回车继续

## 注意事项

1. **账号格式**：必须包含 `account` 和 `password` 字段
2. **S2A配置**：确保 `config.toml` 中的S2A配置正确
3. **验证码接收**：需要能够接收账号邮箱的验证码
4. **浏览器**：需要安装Chrome浏览器
5. **网络**：确保能访问ChatGPT和S2A服务

## 常见问题

### Q: 提示"S2A服务连接失败"

A: 检查 `config.toml` 中的S2A配置：
- `api_base` 是否正确
- `admin_key` 或 `admin_token` 是否有效
- 网络是否能访问S2A服务

### Q: 验证码获取失败

A: 
- 请确保能够接收到邮箱的验证码
- 在终端输入验证码继续流程
- 检查邮箱的垃圾邮件文件夹

### Q: 账号注册失败

A: 可能原因：
- 邮箱域名被OpenAI封禁
- 密码不符合要求（至少8位，包含字母和数字）
- 网络问题

### Q: 授权超时

A: 
- 检查网络连接
- 增加等待时间（修改代码中的 `max_wait` 参数）
- 手动完成授权流程

## 输出示例

```
============================================================
S2A 账号批量添加工具
============================================================

✓ S2A服务连接成功: 认证有效 (方式: Admin API Key, 分组: codex -> [1])
✓ 成功加载 2 个账号

进度: 1/2
============================================================
处理账号: user1@example.com
============================================================

⚠️ 账号已存在于S2A中: user1@example.com

进度: 2/2
============================================================
处理账号: user2@example.com
============================================================

✓ 账号注册/登录成功: user2@example.com
✓ S2A账号创建成功: user2@example.com
✓ ✅ 账号添加成功: user2@example.com

============================================================
处理完成
============================================================
总计: 2 个账号
✓ 成功: 2 个
============================================================
```

## 相关文档

- [项目主README](../../README.md)
- [S2A服务文档](https://github.com/Wei-Shaw/sub2api)
